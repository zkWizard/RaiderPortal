<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RaiderPortal — ARC Raiders Database</title>
  <link rel="stylesheet" href="src/detail.css">
  <style>

    /* ═══════════════════════════════════════════════════════════
       RESET & DESIGN TOKENS
    ═══════════════════════════════════════════════════════════ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg-void:     #09090b;
      --bg-base:     #0f1013;
      --bg-elevated: #1e2028;

      --border:        #2a2d36;
      --border-bright: #3a3d4a;

      --cream:       #ece2d0;
      --cream-dim:   #9a9080;
      --orange:      #ff5600;
      --orange-dim:  #cc4400;
      --orange-glow: rgba(255, 86, 0, 0.14);
      --cyan:        #00e5ff;
      --red:         #d0002a;
      --yellow:      #ffcc00;

      --text-primary:   #ece2d0;
      --text-secondary: #8a8a9a;
      --text-muted:     #4e5060;

      --topnav-h: 48px;
    }

    html {
      font-size: 14px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      height: 100%;
      overflow: hidden;
    }

    body {
      background: var(--bg-void);
      color: var(--text-primary);
      font-family: -apple-system, 'Segoe UI', system-ui, sans-serif;
      height: 100%;
      overflow: hidden;
    }

    a { text-decoration: none; color: inherit; }
    button { cursor: pointer; font-family: inherit; }

    /* ═══════════════════════════════════════════════════════════
       DOT GRID — subtle depth layer, stays fixed behind everything
    ═══════════════════════════════════════════════════════════ */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: radial-gradient(circle, rgba(255,255,255,0.028) 1px, transparent 1px);
      background-size: 38px 38px;
      pointer-events: none;
      z-index: 0;
    }

    /* ═══════════════════════════════════════════════════════════
       VIGNETTE — darkens all four edges for depth and focus
    ═══════════════════════════════════════════════════════════ */
    body::after {
      content: '';
      position: fixed;
      inset: 0;
      background: radial-gradient(
        ellipse 110% 100% at 50% 50%,
        transparent 35%,
        rgba(9, 9, 11, 0.75) 100%
      );
      pointer-events: none;
      z-index: 0;
    }

    /* ═══════════════════════════════════════════════════════════
       TOP NAVIGATION
    ═══════════════════════════════════════════════════════════ */
    .topnav {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: var(--topnav-h);
      background: rgba(9, 9, 11, 0.80);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-bottom: 1px solid rgba(42, 45, 54, 0.9);
      display: flex;
      align-items: center;
      padding: 0 28px;
      gap: 8px;
      z-index: 200;
    }

    /* ARC Raiders stripe accent line beneath the nav */
    .topnav::after {
      content: '';
      position: absolute;
      bottom: -1px; left: 0; right: 0;
      height: 1px;
      background: linear-gradient(
        90deg,
        transparent 0%,
        rgba(0, 229, 255, 0.5) 15%,
        rgba(255, 204, 0, 0.5) 35%,
        rgba(255, 86, 0, 0.6) 60%,
        rgba(208, 0, 42, 0.4) 80%,
        transparent 100%
      );
    }

    /* Small "RP" brand mark in the nav */
    .nav-brand {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-right: 28px;
      flex-shrink: 0;
    }

    .nav-brand-mark {
      width: 26px;
      height: 26px;
    }

    .nav-brand-label {
      font-size: 12px;
      font-weight: 800;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--cream);
    }

    /* Nav links */
    .nav-links {
      display: flex;
      align-items: center;
      gap: 2px;
    }

    .nav-link {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      padding: 6px 11px;
      border-radius: 5px;
      letter-spacing: 0.03em;
      transition: color 0.12s, background 0.12s;
    }

    .nav-link:hover {
      color: var(--cream);
      background: rgba(255, 255, 255, 0.04);
    }

    /* Right side: patch tag + sign in */
    .nav-right {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-left: auto;
    }

    .patch-tag {
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--text-muted);
      border: 1px solid var(--border);
      border-radius: 3px;
      padding: 3px 7px;
    }

    .btn-signin {
      background: none;
      border: 1px solid var(--border-bright);
      border-radius: 5px;
      color: var(--cream-dim);
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      padding: 5px 16px;
      transition: all 0.15s;
    }

    .btn-signin:hover {
      color: var(--cream);
      border-color: var(--orange);
      background: var(--orange-glow);
    }

    /* ═══════════════════════════════════════════════════════════
       MAIN LANDING — full-viewport centered layout
    ═══════════════════════════════════════════════════════════ */
    .landing {
      position: fixed;
      inset: 0;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      /* Slightly above true vertical center — classic for search portals */
      justify-content: center;
      padding-top: calc(var(--topnav-h) + 40px);
      padding-bottom: 80px;
      padding-left: 24px;
      padding-right: 24px;
      z-index: 2;
      transform: translateY(0);
      transition: transform 0.45s cubic-bezier(0.22, 1, 0.36, 1);
      will-change: transform;
      background: var(--bg-void);
    }
    body.detail-active .landing   { transform: translateY(-100%); }
    body.no-transition .landing   { transition: none !important; }

    /* Atmospheric glow centered on the logo — orange-to-cyan radial */
    .atm-glow {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -58%);
      width: 1000px;
      height: 560px;
      background: radial-gradient(
        ellipse at 50% 50%,
        rgba(255, 86, 0,  0.065) 0%,
        rgba(0, 229, 255, 0.040) 40%,
        transparent 68%
      );
      pointer-events: none;
      z-index: 0;
    }

    /* ═══════════════════════════════════════════════════════════
       LOGO GROUP
    ═══════════════════════════════════════════════════════════ */
    .logo-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0;
      margin-bottom: 56px;
      position: relative;
      z-index: 1;
    }

    /* Emblem: displayed at 92px, glows warm */
    .logo-emblem {
      width: 92px;
      height: 92px;
      margin-bottom: 28px;
      filter:
        drop-shadow(0 0 18px rgba(255, 86, 0, 0.40))
        drop-shadow(0 0 40px rgba(255, 86, 0, 0.18))
        drop-shadow(0 0 8px  rgba(0, 229, 255, 0.20));
      transition: filter 0.4s ease;
    }

    .logo-emblem:hover {
      filter:
        drop-shadow(0 0 24px rgba(255, 86, 0, 0.60))
        drop-shadow(0 0 56px rgba(255, 86, 0, 0.26))
        drop-shadow(0 0 12px rgba(0, 229, 255, 0.35));
    }

    /* Wordmark: gradient text matching the ARC Raiders stripe palette */
    .logo-wordmark {
      font-size: 52px;
      font-weight: 900;
      letter-spacing: 0.09em;
      text-transform: uppercase;
      line-height: 1;
      user-select: none;
      background: linear-gradient(
        95deg,
        #00e5ff  0%,
        #b8d840 22%,
        #ffcc00 38%,
        #ff5600 62%,
        #d0002a 100%
      );
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Tagline */
    .logo-tagline {
      margin-top: 12px;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.20em;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    /* ═══════════════════════════════════════════════════════════
       SEARCH GROUP
    ═══════════════════════════════════════════════════════════ */
    .search-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 22px;
      width: 100%;
      max-width: 680px;
      position: relative;
      z-index: 10;
    }

    /* ── Search bar ───────────────────────────────────────── */
    .searchbar {
      position: relative;   /* anchor for the loading bar pseudo-child */
      width: 100%;
      height: 60px;
      display: flex;
      align-items: stretch;
      background: var(--bg-base);
      border: 1px solid var(--border-bright);
      border-radius: 10px;
      overflow: hidden;
      transition:
        border-color 0.18s ease,
        box-shadow 0.22s ease;
    }

    .searchbar:focus-within {
      border-color: var(--orange);
      box-shadow:
        0 0 0 3px var(--orange-glow),
        0 20px 60px rgba(0, 0, 0, 0.55),
        0 4px 20px rgba(255, 86, 0, 0.14);
    }

    /* Category <select> */
    .search-cat {
      position: relative;
      display: flex;
      align-items: center;
      flex-shrink: 0;
      min-width: 110px;
    }

    .search-cat select {
      appearance: none;
      -webkit-appearance: none;
      background: transparent;
      border: none;
      outline: none;
      color: var(--text-secondary);
      font-size: 11px;
      font-weight: 700;
      font-family: inherit;
      letter-spacing: 0.10em;
      text-transform: uppercase;
      padding: 0 34px 0 18px;
      height: 100%;
      width: 100%;
      cursor: pointer;
      transition: color 0.12s;
    }

    /* Style the option elements (limited in cross-browser CSS) */
    .search-cat select option {
      background: #1a1c22;
      color: var(--cream);
      font-size: 13px;
      text-transform: none;
      letter-spacing: 0;
      font-weight: 600;
    }

    .search-cat select:hover,
    .search-cat select:focus {
      color: var(--cream);
    }

    /* Custom chevron arrow */
    .search-cat::after {
      content: '';
      position: absolute;
      right: 13px;
      top: 50%;
      transform: translateY(-50%);
      width: 0; height: 0;
      border-left: 4px solid transparent;
      border-right: 4px solid transparent;
      border-top: 5px solid var(--text-muted);
      pointer-events: none;
      transition: border-top-color 0.12s;
    }

    .search-cat:focus-within::after {
      border-top-color: var(--orange);
    }

    /* Vertical rule between select and input */
    .search-rule {
      width: 1px;
      background: var(--border);
      margin: 13px 0;
      flex-shrink: 0;
    }

    /* Text input */
    .search-input {
      flex: 1;
      background: transparent;
      border: none;
      outline: none;
      color: var(--text-primary);
      font-size: 15px;
      font-family: inherit;
      padding: 0 20px;
      caret-color: var(--orange);
      min-width: 0;
    }

    .search-input::placeholder {
      color: var(--text-muted);
      font-weight: 400;
    }

    /* Keyboard shortcut hint — shown inside the input when empty */
    .search-hint {
      display: flex;
      align-items: center;
      gap: 5px;
      padding-right: 16px;
      flex-shrink: 0;
    }

    .search-hint kbd {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-family: inherit;
      font-size: 10px;
      font-weight: 700;
      color: var(--text-muted);
      border: 1px solid var(--border-bright);
      border-radius: 3px;
      padding: 1px 5px;
      line-height: 1.4;
      letter-spacing: 0;
    }

    /* Hide hint when input is focused or has content */
    .searchbar:focus-within .search-hint { display: none; }

    /* Search button */
    .search-btn {
      background: var(--orange);
      border: none;
      color: #fff;
      font-size: 12px;
      font-weight: 800;
      letter-spacing: 0.10em;
      text-transform: uppercase;
      padding: 0 26px;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
      transition: background 0.15s;
    }

    .search-btn:hover  { background: #ff6d1f; }
    .search-btn:active { background: var(--orange-dim); }

    /* ═══════════════════════════════════════════════════════════
       FOOTER
    ═══════════════════════════════════════════════════════════ */
    .site-footer {
      position: relative;
      z-index: 1;
      padding: 16px 28px;
      border-top: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 28px;
      flex-wrap: wrap;
    }

    .site-footer-item {
      font-size: 11px;
      color: var(--text-muted);
      letter-spacing: 0.02em;
    }

    .site-footer-item a {
      color: var(--text-muted);
      transition: color 0.12s;
    }

    .site-footer-item a:hover { color: var(--cream); }

    .footer-dot {
      color: var(--border-bright);
      font-size: 10px;
      user-select: none;
    }


    /* ═══════════════════════════════════════════════════════════
       SEARCH BAR WRAPPER — relative container for dropdown anchor
    ═══════════════════════════════════════════════════════════ */
    .search-bar-wrap {
      width: 100%;
      position: relative;
    }

    /* ═══════════════════════════════════════════════════════════
       INDEX LOADING BAR
       A rainbow shimmer stripe at the bottom of the search bar
       that plays while buildIndex() is running. Sits inside
       .searchbar so overflow:hidden clips its rounded corners.
    ═══════════════════════════════════════════════════════════ */
    .search-loading-bar {
      position: absolute;
      bottom: 0; left: 0; right: 0;
      height: 2px;
      pointer-events: none;
      overflow: hidden;
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    .search-loading-bar.active { opacity: 1; }

    .search-loading-bar::before {
      content: '';
      position: absolute;
      top: 0; bottom: 0;
      width: 55%;
      background: linear-gradient(
        90deg,
        transparent  0%,
        #00e5ff     20%,
        #ffcc00     45%,
        #ff5600     72%,
        #d0002a     90%,
        transparent 100%
      );
      animation: rpShimmer 1.8s ease-in-out infinite;
    }

    @keyframes rpShimmer {
      0%   { left: -55%; }
      100% { left: 160%; }
    }

    /* ═══════════════════════════════════════════════════════════
       SEARCH DROPDOWN
    ═══════════════════════════════════════════════════════════ */
    .search-dropdown {
      display: none;
      position: absolute;
      top: calc(100% + 6px);
      left: 0;
      right: 0;
      background: #191b22;
      border: 1px solid var(--border-bright);
      border-radius: 10px;
      max-height: 400px;
      overflow-y: auto;
      z-index: 9999;
      box-shadow:
        0 24px 64px rgba(0, 0, 0, 0.72),
        0 8px  24px rgba(0, 0, 0, 0.44),
        inset 0 0 0 1px rgba(255, 255, 255, 0.03);
    }

    .search-dropdown.open { display: block; }

    /* Slim scrollbar */
    .search-dropdown::-webkit-scrollbar         { width: 4px; }
    .search-dropdown::-webkit-scrollbar-track   { background: transparent; }
    .search-dropdown::-webkit-scrollbar-thumb   {
      background: var(--border-bright);
      border-radius: 2px;
    }

    /* ── Result row ───────────────────────────────────────── */
    .search-result {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 0 14px;
      height: 48px;
      cursor: pointer;
      color: var(--text-primary);
      border-bottom: 1px solid rgba(42, 45, 54, 0.55);
      transition: background 0.08s;
    }

    .search-result:last-child { border-bottom: none; }

    .search-result:hover,
    .search-result.active {
      background: rgba(255, 86, 0, 0.08);
    }

    /* Icon thumbnail — 32×32 per spec */
    .sr-icon {
      width: 32px;
      height: 32px;
      border-radius: 4px;
      object-fit: cover;
      flex-shrink: 0;
      background: var(--bg-base);
    }

    /* Placeholder when no icon is available */
    .sr-icon-placeholder {
      width: 32px;
      height: 32px;
      border-radius: 4px;
      flex-shrink: 0;
      background: var(--bg-base);
      border: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Name + meta stacked in a column */
    .sr-body {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      min-width: 0;
      gap: 1px;
    }

    /* Entry name */
    .sr-name {
      font-size: 13px;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Subtype · Rarity secondary line */
    .sr-meta {
      font-size: 10px;
      color: var(--text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Type badge pill */
    .type-badge {
      font-size: 9px;
      font-weight: 800;
      letter-spacing: 0.09em;
      text-transform: uppercase;
      padding: 2px 6px;
      border-radius: 3px;
      border: 1px solid transparent;
      flex-shrink: 0;
      line-height: 1.5;
    }

    /* blue=Item, orange=ARC, green=Quest, purple=Trader */
    .type-badge.item   { color: var(--cyan);  background: rgba(0,  229, 255, 0.08); border-color: rgba(0,  229, 255, 0.20); }
    .type-badge.arc    { color: var(--orange); background: rgba(255,  86,   0, 0.08); border-color: rgba(255,  86,   0, 0.22); }
    .type-badge.quest  { color: #00b87a;       background: rgba(0,  184, 122, 0.08); border-color: rgba(0,  184, 122, 0.22); }
    .type-badge.trader { color: #a855f7;       background: rgba(168, 85,  247, 0.08); border-color: rgba(168, 85,  247, 0.22); }

    /* Empty / no-results / loading state */
    .search-no-results {
      padding: 28px 20px;
      text-align: center;
      color: var(--text-muted);
      font-size: 12px;
      font-weight: 500;
      letter-spacing: 0.03em;
    }

    /* ═══════════════════════════════════════════════════════════
       COMPACT NAV SEARCH — visible only on detail pages
    ═══════════════════════════════════════════════════════════ */
    .nav-search-wrap {
      display: none;
      flex: 1;
      max-width: 500px;
      align-items: center;
      gap: 10px;
    }
    body.detail-active .nav-search-wrap { display: flex; }

    .nav-searchbar-wrap { position: relative; flex: 1; }

    .nav-searchbar {
      display: flex;
      align-items: stretch;
      height: 34px;
      background: var(--bg-base);
      border: 1px solid var(--border-bright);
      border-radius: 7px;
      overflow: hidden;
      transition: border-color 0.15s, box-shadow 0.15s;
    }
    .nav-searchbar:focus-within {
      border-color: rgba(255, 86, 0, 0.55);
      box-shadow: 0 0 0 3px rgba(255, 86, 0, 0.10);
    }

    .nav-search-cat {
      height: 100%;
      padding: 0 10px;
      font-size: 11px;
      font-weight: 700;
      font-family: inherit;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      background: var(--bg-elevated);
      border: none;
      border-right: 1px solid var(--border-bright);
      color: var(--text-secondary);
      cursor: pointer;
      appearance: none;
      -webkit-appearance: none;
    }
    .nav-search-cat:hover,
    .nav-search-cat:focus { color: var(--cream); outline: none; }

    .nav-search-input {
      flex: 1;
      height: 100%;
      padding: 0 12px;
      font-size: 13px;
      font-family: inherit;
      background: transparent;
      border: none;
      color: var(--cream);
      outline: none;
      min-width: 0;
    }
    .nav-search-input::placeholder { color: var(--text-muted); }

    .nav-back {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 34px;
      height: 34px;
      border-radius: 7px;
      flex-shrink: 0;
      color: var(--text-secondary);
      border: 1px solid var(--border-bright);
      background: var(--bg-base);
      transition: color 0.12s, border-color 0.12s;
    }
    .nav-back:hover { color: var(--cream); }

    /* ═══════════════════════════════════════════════════════════
       HAMBURGER BUTTON
    ═══════════════════════════════════════════════════════════ */
    .nav-hamburger {
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 5px;
      width: 36px;
      height: 36px;
      background: none;
      border: 1px solid var(--border-bright);
      border-radius: 6px;
      cursor: pointer;
      padding: 0 8px;
      flex-shrink: 0;
    }

    .nav-hamburger span {
      display: block;
      width: 16px;
      height: 2px;
      background: var(--cream-dim);
      border-radius: 1px;
      pointer-events: none;
      transition: transform 0.2s ease, opacity 0.2s ease;
    }

    .nav-hamburger.open span:nth-child(1) { transform: translateY(7px) rotate(45deg); }
    .nav-hamburger.open span:nth-child(2) { opacity: 0; transform: scaleX(0); }
    .nav-hamburger.open span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }

    /* ═══════════════════════════════════════════════════════════
       RESPONSIVE — 768px (tablet / large phone)
    ═══════════════════════════════════════════════════════════ */
    @media (max-width: 768px) {
      /* ── Topnav ─────────────────────────────────────────── */
      .topnav { padding: 0 14px; gap: 6px; }
      .nav-brand { margin-right: 0; }
      .nav-brand-label { display: none; }

      /* Show hamburger; move nav links into a fixed drawer */
      .nav-hamburger { display: flex; }

      .nav-links {
        position: fixed;
        top: var(--topnav-h);
        left: 0;
        right: 0;
        display: none;
        flex-direction: column;
        background: rgba(9, 9, 11, 0.97);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--border-bright);
        padding: 6px 0;
        gap: 0;
        z-index: 190;
      }

      .nav-links.mobile-open { display: flex; }

      .nav-link {
        padding: 14px 20px;
        font-size: 14px;
        border-radius: 0;
        border-bottom: 1px solid rgba(42, 45, 54, 0.4);
        letter-spacing: 0.04em;
      }

      .nav-link:last-child { border-bottom: none; }

      .patch-tag { display: none; }
      .nav-right { gap: 8px; }

      /* Compact nav search: let it grow to fill available space */
      .nav-search-wrap { max-width: none; }

      /* ── Landing ────────────────────────────────────────── */
      .landing {
        padding-top: calc(var(--topnav-h) + 24px);
        padding-bottom: 40px;
        padding-left: 16px;
        padding-right: 16px;
        justify-content: flex-start;
      }

      .logo-group  { margin-bottom: 32px; }
      .logo-emblem { width: 68px; height: 68px; margin-bottom: 18px; }
      .logo-wordmark { font-size: 36px; }
      .logo-tagline  { font-size: 10px; margin-top: 8px; }

      /* ── Search ─────────────────────────────────────────── */
      .search-group { gap: 14px; }
      .searchbar    { height: 52px; }
      .search-hint  { display: none; }
      .search-btn   { padding: 0 18px; font-size: 11px; gap: 6px; }

      /* ── Dropdown ───────────────────────────────────────── */
      .search-result { height: 50px; }

      /* ── Footer ─────────────────────────────────────────── */
      .site-footer {
        flex-direction: column;
        gap: 6px;
        padding: 14px 16px;
        text-align: center;
      }
      .footer-dot { display: none; }
    }

    /* ═══════════════════════════════════════════════════════════
       RESPONSIVE — 480px (small phones)
    ═══════════════════════════════════════════════════════════ */
    @media (max-width: 480px) {
      .logo-wordmark { font-size: 28px; letter-spacing: 0.06em; }
      .logo-tagline  { letter-spacing: 0.12em; }

      /* Narrow the category selector to give the text input more room */
      .search-cat { min-width: auto; }
      .search-cat select { padding: 0 22px 0 10px; font-size: 10px; }

      .search-btn { padding: 0 14px; }
      .search-btn svg { display: none; }

      .btn-signin { padding: 5px 10px; font-size: 10px; }
    }

  </style>
</head>
<body>

  <!-- ═══════════════════════════════════════════════════════════
       TOP NAVIGATION
  ═══════════════════════════════════════════════════════════ -->
  <nav class="topnav" role="navigation" aria-label="Primary">

    <!-- Small RP mark -->
    <a class="nav-brand" href="#" aria-label="RaiderPortal home">
      <svg class="nav-brand-mark" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <rect width="26" height="26" rx="5" fill="#0f1013"/>
        <clipPath id="nm"><rect x="2" y="2" width="22" height="22" rx="3"/></clipPath>
        <g clip-path="url(#nm)">
          <polygon points="2,2 10,2 2,10" fill="#00e5ff" opacity="0.9"/>
          <polygon points="10,2 18,2 2,18 2,10" fill="#ffcc00" opacity="0.85"/>
          <polygon points="18,2 24,2 24,9 9,24 2,24 2,18" fill="#ff5600" opacity="0.9"/>
          <polygon points="24,9 24,24 9,24" fill="#d0002a" opacity="0.85"/>
        </g>
        <rect x="2" y="2" width="22" height="22" rx="3" fill="none" stroke="rgba(236,226,208,0.12)" stroke-width="1"/>
      </svg>
      <span class="nav-brand-label">RaiderPortal</span>
    </a>

    <!-- Compact search — visible only on detail pages (body.detail-active) -->
    <div class="nav-search-wrap" id="navSearchWrap">
      <a class="nav-back" href="#" aria-label="Back to search" title="Back to search">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
             stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M19 12H5M12 5l-7 7 7 7"/>
        </svg>
      </a>
      <div class="nav-searchbar-wrap" id="navSearchBarWrap">
        <div class="nav-searchbar" id="navSearchBar">
          <select id="navSearchCategory" class="nav-search-cat" aria-label="Search category">
            <option value="all">All</option>
            <option value="items">Items</option>
            <option value="arcs">ARCs</option>
            <option value="quests">Quests</option>
            <option value="traders">Traders</option>
          </select>
          <input id="navSearchInput" class="nav-search-input" type="search"
                 placeholder="Search database…" autocomplete="off" spellcheck="false"
                 aria-label="Search RaiderPortal"/>
        </div>
        <!-- nav dropdown injected here by JS -->
      </div>
    </div>

    <div class="nav-links">
      <a class="nav-link" href="#/items">Items</a>
      <a class="nav-link" href="#/quests">Quests</a>
      <a class="nav-link" href="#/arc">ARC</a>
      <a class="nav-link" href="#/traders">Traders</a>
      <a class="nav-link" href="#/events">Events</a>
    </div>

    <div class="nav-right">
      <span class="patch-tag">Patch 1.4.2</span>
      <button class="btn-signin" type="button">Sign In</button>
      <button class="nav-hamburger" id="navHamburger" aria-label="Toggle navigation" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>
    </div>

  </nav>


  <!-- ═══════════════════════════════════════════════════════════
       MAIN LANDING
  ═══════════════════════════════════════════════════════════ -->
  <main class="landing" id="landing" role="main">

    <!-- Atmospheric radial glow behind the logo -->
    <div class="atm-glow" aria-hidden="true"></div>

    <!-- ── Logo group ─────────────────────────────────────── -->
    <header class="logo-group">

      <!-- Emblem SVG — ARC Raiders diagonal stripe motif -->
      <svg class="logo-emblem" viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <defs>
          <clipPath id="ec">
            <!-- Clip to an inner rounded square, leaving room for outer ring -->
            <rect x="3" y="3" width="66" height="66" rx="11"/>
          </clipPath>
          <!-- Subtle inner glow filter on the whole shape -->
          <filter id="innerGlow" x="-10%" y="-10%" width="120%" height="120%">
            <feGaussianBlur in="SourceGraphic" stdDeviation="1.5" result="blur"/>
            <feComposite in="SourceGraphic" in2="blur" operator="over"/>
          </filter>
        </defs>

        <!-- Outermost dark background -->
        <rect width="72" height="72" rx="13" fill="#09090b"/>

        <!-- Inner base — very slightly lighter -->
        <rect x="3" y="3" width="66" height="66" rx="11" fill="#0f1013"/>

        <!-- Diagonal stripe bands, clipped to the inner rounded square -->
        <g clip-path="url(#ec)">
          <!-- Cyan — thin top-left corner -->
          <polygon points="3,3 22,3 3,22" fill="#00e5ff" opacity="0.92"/>
          <!-- Yellow — thin diagonal strip -->
          <polygon points="22,3 44,3 3,44 3,22" fill="#ffcc00" opacity="0.88"/>
          <!-- Orange — dominant central band -->
          <polygon points="44,3 69,3 69,30 30,69 3,69 3,44" fill="#ff5600" opacity="0.92"/>
          <!-- Red — bottom-right corner -->
          <polygon points="69,30 69,69 30,69" fill="#d0002a" opacity="0.88"/>
        </g>

        <!-- Inner border ring — cream at low opacity -->
        <rect x="3" y="3" width="66" height="66" rx="11"
              fill="none" stroke="rgba(236,226,208,0.14)" stroke-width="1"/>

        <!-- "R" letterform — cream, dark stroke for legibility over stripes -->
        <text
          x="36" y="55"
          font-family="-apple-system, 'Segoe UI', system-ui, sans-serif"
          font-weight="900"
          font-size="42"
          text-anchor="middle"
          fill="rgba(236,226,208,0.96)"
          stroke="#09090b"
          stroke-width="3"
          paint-order="stroke fill"
        >R</text>

        <!-- Subtle outer ring -->
        <rect x="0.5" y="0.5" width="71" height="71" rx="12.5"
              fill="none" stroke="rgba(255,86,0,0.18)" stroke-width="1"/>
      </svg>

      <!-- Wordmark -->
      <h1 class="logo-wordmark">Raider&thinsp;Portal</h1>

      <!-- Tagline -->
      <p class="logo-tagline">ARC Raiders Game Database</p>

    </header><!-- /.logo-group -->


    <!-- ── Search group ──────────────────────────────────── -->
    <div class="search-group" role="search">

      <!-- Wrapper gives the dropdown an anchor point directly below the bar -->
      <div class="search-bar-wrap">

      <div class="searchbar" id="searchBar">

        <!-- Category selector -->
        <div class="search-cat">
          <select id="searchCategory" aria-label="Search category">
            <option value="all">All</option>
            <option value="items">Items</option>
            <option value="arcs">ARCs</option>
            <option value="quests">Quests</option>
            <option value="traders">Traders</option>
            <option value="events">Events</option>
          </select>
        </div>

        <!-- Vertical rule -->
        <div class="search-rule" aria-hidden="true"></div>

        <!-- Text input -->
        <input
          class="search-input"
          id="searchInput"
          type="search"
          placeholder="Search items, ARCs, quests, traders…"
          autocomplete="off"
          autocorrect="off"
          spellcheck="false"
          aria-label="Search RaiderPortal"
        />

        <!-- Keyboard shortcut hint — hidden on focus via CSS -->
        <div class="search-hint" aria-hidden="true">
          <kbd>/</kbd>
        </div>

        <!-- Search button -->
        <button class="search-btn" type="button" aria-label="Submit search">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
               stroke="currentColor" stroke-width="2.5"
               stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.35-4.35"/>
          </svg>
          Search
        </button>

      </div><!-- /.searchbar -->
      <!-- Dropdown and loading bar injected here by JS -->

      </div><!-- /.search-bar-wrap -->

    </div><!-- /.search-group -->

    <footer class="site-footer" role="contentinfo">
      <span class="site-footer-item">© 2026 RaiderPortal</span>
      <span class="footer-dot" aria-hidden="true">◆</span>
      <span class="site-footer-item">
        Data from <a href="https://metaforge.app/arc-raiders" target="_blank" rel="noopener">MetaForge</a>
      </span>
      <span class="footer-dot" aria-hidden="true">◆</span>
      <span class="site-footer-item">Fan project — not affiliated with Embark Studios</span>
    </footer>

  </main><!-- /.landing -->


  <!-- ═══════════════════════════════════════════════════════════
       DETAIL VIEW — slides in from below when a hash route matches.
       Driven by body.detail-active via CSS transforms.
  ═══════════════════════════════════════════════════════════ -->
  <div id="detailView" class="detail-view">
    <div class="detail-container">
      <div id="detailContent"></div>
    </div>
  </div>


  <script type="module">
    import { buildIndex, search, getIndexState } from './src/services/searchIndex.js';
    import { initRouter } from './src/router.js';

    // ─── Category select → index type ──────────────────────────
    const CATEGORY_TYPE = {
      all:     undefined,
      items:   'Item',
      arcs:    'ARC',
      quests:  'Quest',
      traders: 'Trader',
      // 'events' intentionally omitted — not yet in the search index
    };

    // ─── Route helper ───────────────────────────────────────────
    // Items use the normalised base-name slug so all tiers share one page.
    function routeFor(entry) {
      if (entry.type === 'Item') {
        return `#/item/${encodeURIComponent(entry.baseSlug)}`;
      }
      return `#/${entry.type.toLowerCase()}/${encodeURIComponent(entry.id)}`;
    }

    // ─── Placeholder icon SVGs (one per type) ───────────────────
    const TYPE_COLORS = {
      item:   '#00e5ff',
      arc:    '#ff5600',
      quest:  '#ffcc00',
      trader: '#00b87a',
    };

    const TYPE_SVG_PATHS = {
      item:   '<path d="M12 2L2 7v5c0 5.5 3.8 10.7 9 12.2C16.2 22.7 20 17.5 20 12V7L12 2z" stroke-width="1.5" stroke="currentColor" fill="none"/>',
      arc:    '<polygon points="12,2 22,20 2,20" stroke-width="1.5" stroke="currentColor" fill="none"/><line x1="12" y1="8" x2="12" y2="13" stroke-width="1.5" stroke="currentColor"/><circle cx="12" cy="16" r="1" fill="currentColor"/>',
      quest:  '<rect x="5" y="3" width="14" height="18" rx="2" stroke-width="1.5" stroke="currentColor" fill="none"/><path d="M9 8h6M9 12h6M9 16h4" stroke-width="1.5" stroke="currentColor"/>',
      trader: '<circle cx="12" cy="8" r="3.5" stroke-width="1.5" stroke="currentColor" fill="none"/><path d="M5 20c0-3.9 3.1-7 7-7s7 3.1 7 7" stroke-width="1.5" stroke="currentColor" fill="none"/>',
    };

    const TYPE_LABELS = { item: 'Item', arc: 'ARC', quest: 'Quest', trader: 'Trader' };

    function makePlaceholder(type) {
      const key = type.toLowerCase();
      const el = document.createElement('div');
      el.className = 'sr-icon-placeholder';
      el.style.color = TYPE_COLORS[key] ?? 'var(--text-muted)';
      el.innerHTML = `<svg width="13" height="13" viewBox="0 0 24 24" fill="none"
        xmlns="http://www.w3.org/2000/svg">${TYPE_SVG_PATHS[key] ?? ''}</svg>`;
      return el;
    }

    function buildRow(entry) {
      const a = document.createElement('a');
      a.className = 'search-result';
      a.href = routeFor(entry);

      if (entry.icon) {
        const img = document.createElement('img');
        img.className = 'sr-icon';
        img.src = entry.icon;
        img.alt = '';
        img.loading = 'lazy';
        img.onerror = () => img.replaceWith(makePlaceholder(entry.type));
        a.appendChild(img);
      } else {
        a.appendChild(makePlaceholder(entry.type));
      }

      const body = document.createElement('div');
      body.className = 'sr-body';

      const nameEl = document.createElement('span');
      nameEl.className = 'sr-name';
      nameEl.textContent = entry.name;
      body.appendChild(nameEl);

      const metaParts = [entry.subtype, entry.rarity].filter(Boolean);
      if (metaParts.length) {
        const meta = document.createElement('span');
        meta.className = 'sr-meta';
        meta.textContent = metaParts.join(' · ');
        body.appendChild(meta);
      }

      a.appendChild(body);

      const badge = document.createElement('span');
      const typeKey = entry.type.toLowerCase();
      badge.className = `type-badge ${typeKey}`;
      badge.textContent = TYPE_LABELS[typeKey] ?? entry.type;
      a.appendChild(badge);

      return a;
    }

    // ─── Search bar factory ──────────────────────────────────────
    // Creates a fully functional search bar (dropdown, keyboard nav, debounce)
    // on any input/select/container triplet. Returns { loadingBar, runSearch }.
    function initSearchBar({ inputEl, categoryEl, wrapEl, barEl, onNavigate }) {
      let activeIdx      = -1;
      let currentResults = [];
      let debounceTimer;

      // Optional loading bar — injected into barEl if provided
      let loadingBar = null;
      if (barEl) {
        loadingBar = document.createElement('div');
        loadingBar.className = 'search-loading-bar';
        barEl.appendChild(loadingBar);
      }

      // Dropdown — injected into wrapEl
      const dropdown = document.createElement('div');
      dropdown.className = 'search-dropdown';
      dropdown.setAttribute('role', 'listbox');
      dropdown.setAttribute('aria-label', 'Search results');
      wrapEl.appendChild(dropdown);

      function showDropdownMessage(text) {
        dropdown.innerHTML = '';
        const el = document.createElement('div');
        el.className = 'search-no-results';
        el.textContent = text;
        dropdown.appendChild(el);
        dropdown.classList.add('open');
      }

      function openDropdown(results, query) {
        currentResults = results;
        activeIdx = -1;
        dropdown.innerHTML = '';
        if (results.length === 0) {
          showDropdownMessage(`No results found for "${query}"`);
          return;
        }
        results.forEach((entry) => dropdown.appendChild(buildRow(entry)));
        dropdown.classList.add('open');
      }

      function closeDropdown() {
        dropdown.classList.remove('open');
        activeIdx = -1;
      }

      function setActive(idx) {
        const rows = dropdown.querySelectorAll('.search-result');
        rows.forEach((r, i) => r.classList.toggle('active', i === idx));
        activeIdx = idx;
        if (idx >= 0) rows[idx]?.scrollIntoView({ block: 'nearest' });
      }

      function runSearch() {
        const q = inputEl.value.trim();
        if (q.length < 2) { closeDropdown(); return; }
        if (categoryEl.value === 'events') { closeDropdown(); return; }

        const { state } = getIndexState();
        if (state !== 'ready') {
          showDropdownMessage('Loading game database…');
          return;
        }

        const type    = CATEGORY_TYPE[categoryEl.value];
        const results = search(q, { limit: 25, type });
        openDropdown(results, q);
      }

      function scheduleSearch() {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(runSearch, 150);
      }

      inputEl.addEventListener('input', scheduleSearch);
      categoryEl.addEventListener('change', scheduleSearch);

      inputEl.addEventListener('keydown', (e) => {
        const isOpen = dropdown.classList.contains('open');

        if (e.key === 'ArrowDown') {
          if (!isOpen) return;
          e.preventDefault();
          setActive(Math.min(activeIdx + 1, currentResults.length - 1));

        } else if (e.key === 'ArrowUp') {
          if (!isOpen) return;
          e.preventDefault();
          setActive(Math.max(activeIdx - 1, 0));

        } else if (e.key === 'Enter') {
          if (isOpen && activeIdx >= 0) {
            e.preventDefault();
            onNavigate(routeFor(currentResults[activeIdx]));
            closeDropdown();
            inputEl.blur();
          } else {
            runSearch();
          }

        } else if (e.key === 'Escape') {
          closeDropdown();
          inputEl.blur();
        }
      });

      // Close when clicking outside the wrapper
      document.addEventListener('click', (e) => {
        if (!wrapEl.contains(e.target)) closeDropdown();
      });

      // Intercept result clicks so onNavigate is always called (allows saving query)
      dropdown.addEventListener('click', (e) => {
        const resultEl = e.target.closest('.search-result');
        if (resultEl) {
          e.preventDefault();
          onNavigate(resultEl.getAttribute('href'));
        }
        closeDropdown();
        inputEl.blur();
      });

      return { loadingBar, runSearch };
    }

    // ─── Landing search ──────────────────────────────────────────
    let savedQuery = '';

    const landingSearch = initSearchBar({
      inputEl:    document.getElementById('searchInput'),
      categoryEl: document.getElementById('searchCategory'),
      wrapEl:     document.querySelector('.search-bar-wrap'),
      barEl:      document.getElementById('searchBar'),
      onNavigate: (href) => {
        savedQuery = document.getElementById('searchInput').value;
        window.location.href = href;
      },
    });

    // ─── Nav (compact) search ────────────────────────────────────
    initSearchBar({
      inputEl:    document.getElementById('navSearchInput'),
      categoryEl: document.getElementById('navSearchCategory'),
      wrapEl:     document.getElementById('navSearchBarWrap'),
      barEl:      null,
      onNavigate: (href) => { window.location.href = href; },
    });

    // ─── Restore search query when returning to landing ──────────
    document.addEventListener('rp:showLanding', () => {
      const inp = document.getElementById('searchInput');
      if (savedQuery && inp.value !== savedQuery) {
        inp.value = savedQuery;
        landingSearch.runSearch();
      }
    });

    // ─── "/" shortcut — focus the landing search input ──────────
    document.addEventListener('keydown', (e) => {
      const tag = document.activeElement?.tagName;
      if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;
      if (e.key === '/') {
        e.preventDefault();
        document.getElementById('searchInput').focus();
      }
    });

    // ─── Hamburger menu ─────────────────────────────────────────
    {
      const hamburger  = document.getElementById('navHamburger');
      const navLinksEl = document.querySelector('.nav-links');

      function closeMenu() {
        navLinksEl.classList.remove('mobile-open');
        hamburger.classList.remove('open');
        hamburger.setAttribute('aria-expanded', 'false');
      }

      hamburger.addEventListener('click', (e) => {
        e.stopPropagation();
        const isOpen = navLinksEl.classList.toggle('mobile-open');
        hamburger.classList.toggle('open', isOpen);
        hamburger.setAttribute('aria-expanded', String(isOpen));
      });

      // Tapping a nav link closes the drawer and navigates
      navLinksEl.addEventListener('click', (e) => {
        if (e.target.classList.contains('nav-link')) closeMenu();
      });

      // Click outside topnav closes the drawer
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.topnav')) closeMenu();
      });
    }

    // ─── Start the hash router ──────────────────────────────────
    // Runs immediately so direct-URL visits work without waiting for index.
    initRouter();

    // ─── Kick off index build on page load ──────────────────────
    if (landingSearch.loadingBar) landingSearch.loadingBar.classList.add('active');

    buildIndex()
      .then(() => {
        if (landingSearch.loadingBar) landingSearch.loadingBar.classList.remove('active');
        if (document.getElementById('searchInput').value.trim().length >= 2) {
          landingSearch.runSearch();
        }
      })
      .catch((err) => {
        if (landingSearch.loadingBar) landingSearch.loadingBar.classList.remove('active');
        console.error('[RaiderPortal] Search index build failed:', err);
      });
  </script>

</body>
</html>
